<!--
  Admin-Layout (responsive)
  - Desktop: Sidebar dauerhaft sichtbar (mode="side")
  - Mobil: Sidebar überlagert, via Hamburger-Menü (mode="over")
-->
<mat-sidenav-container class="shell">
  <!-- Sidebar -->
  <mat-sidenav
    #sidenav
    class="side"
    aria-label="Admin Navigation"
    [mode]="isMobile ? 'over' : 'side'"
    [opened]="!isMobile"
  >
    <div class="side-shell">
      <!-- Kopfbereich -->
      <div class="side-header">
        <div class="brand">
          <span class="brand-text">Umfrage-Tool</span>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="nav">
        <a mat-list-item routerLink="/admin/surveys" routerLinkActive="active">
          <mat-icon matListIcon>assignment</mat-icon>
          <span class="label">{{ 'sidebar.surveys' | translate }}</span>
        </a>

        <a mat-list-item routerLink="/admin/results" routerLinkActive="active">
          <mat-icon matListIcon>bar_chart</mat-icon>
          <span class="label">{{ 'sidebar.results' | translate }}</span>
        </a>
      </nav>

      <div class="spacer"></div>

      <!-- Unteres Menü -->
      <nav class="bottom">
        <!-- Sprache wechseln -->
        <a mat-list-item (click)="switchLang(currentLang==='de' ? 'en' : 'de')">
          <mat-icon matListIcon>language</mat-icon>
          <span class="label">{{ 'sidebar.switch' | translate }}</span>
        </a>

        <a mat-list-item routerLink="/admin/profile" routerLinkActive="active">
          <mat-icon matListIcon>person</mat-icon>
          <span class="label">{{ 'sidebar.profile' | translate }}</span>
        </a>

        <a mat-list-item (click)="logout()">
          <mat-icon matListIcon>logout</mat-icon>
          <span class="label">{{ 'sidebar.logout' | translate }}</span>
        </a>

      </nav>
    </div>
  </mat-sidenav>

  <!-- Hauptinhalt -->
  <mat-sidenav-content class="content">
    <mat-toolbar color="primary" class="topbar">
      <!-- Hamburger-Menü mobil -->
      <button
        *ngIf="isMobile"
        mat-icon-button
        (click)="sidenav.toggle()"
        aria-label="Menü öffnen"
      >
        <mat-icon>menu</mat-icon>
      </button>

      <!-- Seitentitel -->
      <div class="page-title">{{ (pageTitle$ | async) ?? '' | translate }}</div>
      <span class="flex-spacer"></span>

      <!-- Benutzer-Menü -->
      <ng-container *ngIf="avatar$ | async as photo; else noPhoto">
        <button
          mat-icon-button
          [matMenuTriggerFor]="userMenu"
          class="avatar-btn"
          aria-label="Benutzer-Menü"
        >
          <img [src]="photo" alt="Avatar" />
        </button>
      </ng-container>
      <ng-template #noPhoto>
        <button
          mat-icon-button
          [matMenuTriggerFor]="userMenu"
          class="avatar-btn"
          aria-label="Benutzer-Menü"
        >
          <mat-icon>account_circle</mat-icon>
        </button>
      </ng-template>

      <mat-menu #userMenu="matMenu">
        <h4 class="displayname">{{ displayName }}</h4>
        <button mat-menu-item routerLink="/admin/profile">
          <span>{{ 'menu.profile' | translate }}</span>
        </button>
        <button mat-menu-item (click)="changeAvatar()">
          <span>{{ 'menu.avatar' | translate }}</span>
        </button>

        <!-- Sprache wechseln -->
        <button mat-menu-item (click)="switchLang(currentLang==='de' ? 'en' : 'de')">
          <span>{{ 'menu.switch' | translate }}</span>
        </button>

        <button mat-menu-item (click)="logout()">
          <span>{{ 'menu.logout' | translate }}</span>
        </button>
      </mat-menu>
    </mat-toolbar>

    <!-- Router Outlet -->
    <div class="route-slot">
      <router-outlet></router-outlet>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
