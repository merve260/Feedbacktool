<div class="toolbar">
  <!-- Suchfeld + Button -->
  <div class="search">
    <mat-icon>search</mat-icon>
    <input
      type="search"
      placeholder="Suchen nach Titel…"
      [(ngModel)]="search"
      (input)="applyView()"
      aria-label="Suche nach Titel" />
    <button *ngIf="search" class="clear" (click)="clearSearch()" aria-label="Suche löschen">
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <button class="btn btn-primary" (click)="create()">+ Erstellen</button>
</div>

<!-- Lade-Status -->
<div *ngIf="loading" class="loading">Lade…</div>

<!-- Wenn keine Umfragen existieren -->
<div *ngIf="!loading && items.length === 0" class="empty-card">
  <p class="empty-text">Es gibt noch keine Umfrage.</p>
  <button class="btn-cta" (click)="create()">
    <mat-icon>add_circle</mat-icon>
    Jetzt Erstellen!
  </button>
</div>


<!-- Liste mit Umfragen -->
<div *ngIf="!loading && items.length > 0" class="list">
  <div class="row head">
    <div>Titel</div>
    <div>Zeitraum</div>
    <div>Status</div>

    <!-- Sortierung nach Erstellungsdatum -->
    <div class="th-sort"
         role="button" tabindex="0"
         (click)="toggleCreatedSort()"
         (keydown.enter)="toggleCreatedSort()"
         [attr.aria-sort]="sortDir==='desc' ? 'descending' : 'ascending'">
      Erstellt am
      <mat-icon class="caret" [class.asc]="sortDir==='asc'">arrow_drop_down</mat-icon>
    </div>

    <div class="actions">Aktionen</div>
  </div>

  <!-- Jede Umfrage in einer Reihe -->
  <div class="row" *ngFor="let s of items">
    <div class="title">{{ s.title }}</div>
    <div class="range">
      <span *ngIf="s.startAt as a">{{ a | date:'dd.MM.yyyy' }}</span>
      –
      <span *ngIf="s.endAt as b">{{ b | date:'dd.MM.yyyy' }}</span>
    </div>
    <div><span class="{{ statusClass(s.status) }}">{{ s.status }}</span></div>
    <div class="created">
      <span *ngIf="s.createdAt as c">{{ c | date:'dd.MM.yyyy HH:mm' }}</span>
      <span *ngIf="!s.createdAt">–</span>
    </div>

    <!-- Menü für Bearbeiten, Veröffentlichen usw. -->
    <div class="actions">
      <button mat-icon-button [matMenuTriggerFor]="menu" matMenuPositionX="before" aria-label="Aktionen">
        <mat-icon>more_vert</mat-icon>
      </button>

      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="edit(s)">
          <mat-icon>edit</mat-icon>
          <span>Bearbeiten</span>
        </button>

        <button mat-menu-item *ngIf="s.status==='draft'" (click)="publish(s)">
          <mat-icon>publish</mat-icon>
          <span>Veröffentlichen</span>
        </button>

        <button mat-menu-item *ngIf="s.status==='published' || s.status ==='closed'" (click)="unpublish(s)">
          <mat-icon>undo</mat-icon>
          <span>Zurückziehen</span>
        </button>

        <button mat-menu-item *ngIf="s.status==='published' || s.status==='draft'" (click)="close(s)">
          <mat-icon>block</mat-icon>
          <span>Schließen</span>
        </button>

        <button mat-menu-item *ngIf="s.status==='published'" (click)="openLinkDialog(s)">
          <mat-icon>link</mat-icon>
          <span>Link anzeigen</span>
        </button>

        <button mat-menu-item (click)="remove(s)" class="warn">
          <mat-icon>delete</mat-icon>
          <span>Löschen</span>
        </button>
      </mat-menu>

    </div>
  </div>
</div>

<!-- Erklärung der Status-Werte -->
<div class="status-hinweis" *ngIf="showStatusHinweis">
  <mat-icon class="info-icon">info</mat-icon>
  <div class="content">
    <strong>Status-Erklärung:</strong>
    <ul>
      <li><span class="chip chip--pub">published</span> – Umfrage aktiv, Link erreichbar.</li>
      <li><span class="chip chip--closed">closed</span> – Umfrage beendet, Link nicht mehr verfügbar.</li>
      <li><span class="chip chip--draft">draft</span> – Umfrage noch im Entwurf.</li>
    </ul>
  </div>
  <button mat-icon-button class="close-btn" (click)="showStatusHinweis = false">
    <mat-icon>close</mat-icon>
  </button>
</div>
