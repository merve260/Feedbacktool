<div class="toolbar">
  <!-- Suchfeld + Button -->
  <div class="search">
    <mat-icon>search</mat-icon>
    <input
      type="search"
      [placeholder]="'dashboard.searchPlaceholder' | translate"
      [(ngModel)]="search"
      (input)="applyView()"
      [attr.aria-label]="'dashboard.searchPlaceholder' | translate" />
    <button *ngIf="search"
            class="clear"
            (click)="clearSearch()"
            [attr.aria-label]="'dashboard.searchClear' | translate">
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <button class="btn btn-primary" (click)="create()">
    + {{ 'dashboard.create' | translate }}
  </button>
</div>

<h2 class="welcome">
  {{ 'dashboard.welcome' | translate:{ name: displayName } }}
</h2>

<!-- Lade-Status -->
<div *ngIf="loading" class="loading">
  {{ 'dashboard.loading' | translate }}
</div>

<!-- Wenn keine Umfragen existieren -->
<div *ngIf="!loading && items.length === 0" class="empty-card">
  <p class="empty-text">{{ 'dashboard.emptyText' | translate }}</p>
  <button class="btn-cta" (click)="create()">
    <mat-icon>add_circle</mat-icon>
    {{ 'dashboard.emptyCta' | translate }}
  </button>
</div>

<!-- Liste mit Umfragen -->
<div *ngIf="!loading && items.length > 0" class="list">
  <div class="row head">
    <div>{{ 'dashboard.table.title' | translate }}</div>
    <div>{{ 'dashboard.table.range' | translate }}</div>
    <div>{{ 'dashboard.table.status' | translate }}</div>

    <!-- Sortierung nach Erstellungsdatum -->
    <div class="th-sort"
         role="button"
         tabindex="0"
         (click)="toggleCreatedSort()"
         (keydown.enter)="toggleCreatedSort()"
         [attr.aria-sort]="sortDir==='desc' ? 'descending' : 'ascending'">
      {{ 'dashboard.table.created' | translate }}
      <mat-icon class="caret" [class.asc]="sortDir==='asc'">arrow_drop_down</mat-icon>
    </div>

    <div class="actions">{{ 'dashboard.table.actions' | translate }}</div>
  </div>

  <!-- Jede Umfrage -->
  <div class="row" *ngFor="let s of items">
    <div class="title">{{ s.title }}</div>
    <div class="range">
      <span *ngIf="s.startAt as a">{{ a | date:'dd.MM.yyyy' }}</span>
      –
      <span *ngIf="s.endAt as b">{{ b | date:'dd.MM.yyyy' }}</span>
    </div>
    <div>
      <span class="{{ statusClass(s.status) }}">
        {{ 'status.' + s.status | translate }}
      </span>
    </div>
    <div class="created">
      <span *ngIf="s.createdAt as c">{{ c | date:'dd.MM.yyyy HH:mm' }}</span>
      <span *ngIf="!s.createdAt">–</span>
    </div>

    <!-- Menü für Aktionen -->
    <div class="actions">
      <button mat-icon-button
              [matMenuTriggerFor]="menu"
              matMenuPositionX="before"
              [attr.aria-label]="'dashboard.table.actions' | translate">
        <mat-icon>more_vert</mat-icon>
      </button>

      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="edit(s)">
          <mat-icon>edit</mat-icon>
          <span>{{ 'dashboard.actions.edit' | translate }}</span>
        </button>

        <button mat-menu-item *ngIf="s.status==='draft'" (click)="publish(s)">
          <mat-icon>publish</mat-icon>
          <span>{{ 'dashboard.actions.publish' | translate }}</span>
        </button>

        <button mat-menu-item *ngIf="s.status==='published' || s.status==='closed'" (click)="unpublish(s)">
          <mat-icon>undo</mat-icon>
          <span>{{ 'dashboard.actions.unpublish' | translate }}</span>
        </button>

        <button mat-menu-item *ngIf="s.status==='published' || s.status==='draft'" (click)="close(s)">
          <mat-icon>block</mat-icon>
          <span>{{ 'dashboard.actions.close' | translate }}</span>
        </button>

        <button mat-menu-item *ngIf="s.status==='published'" (click)="openLinkDialog(s)">
          <mat-icon>link</mat-icon>
          <span>{{ 'dashboard.actions.link' | translate }}</span>
        </button>

        <button mat-menu-item (click)="remove(s)" class="warn">
          <mat-icon>delete</mat-icon>
          <span>{{ 'dashboard.actions.delete' | translate }}</span>
        </button>
      </mat-menu>
    </div>
  </div>
</div>

<!-- Erklärung der Status-Werte -->
<div class="status-hinweis" *ngIf="showStatusHinweis">
  <mat-icon class="info-icon">info</mat-icon>
  <div class="content">
    <strong>{{ 'dashboard.statusHint.title' | translate }}</strong>
    <ul>
      <li>
        <span class="chip chip--pub">{{ 'status.published' | translate }}</span> –
        {{ 'dashboard.statusHint.published' | translate }}
      </li>
      <li>
        <span class="chip chip--closed">{{ 'status.closed' | translate }}</span> –
        {{ 'dashboard.statusHint.closed' | translate }}
      </li>
      <li>
        <span class="chip chip--draft">{{ 'status.draft' | translate }}</span> –
        {{ 'dashboard.statusHint.draft' | translate }}
      </li>
    </ul>
  </div>
  <button mat-icon-button class="close-btn" (click)="showStatusHinweis = false">
    <mat-icon>close</mat-icon>
  </button>
</div>
