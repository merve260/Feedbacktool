<div class="toolbar">
  <!-- Suchen -->
  <div class="search">
    <mat-icon>search</mat-icon>
    <input
      type="search"
      placeholder="Suchen nach Titel…"
      [(ngModel)]="search"
      (input)="applyView()"
      aria-label="Suche nach Titel" />
    <button *ngIf="search" class="clear" (click)="clearSearch()" aria-label="Suche löschen">
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <button class="btn btn-primary" (click)="create()">+ Erstellen</button>
</div>

<div *ngIf="loading" class="loading">Lade…</div>

<div *ngIf="!loading && items.length === 0" class="empty">
  <p>Es gibt noch keine Umfrage.</p>
  <button class="btn" (click)="create()">Jetzt Erstellen!</button>
</div>

<div *ngIf="!loading && items.length > 0" class="list">
  <div class="row head">
    <div>Titel</div>
    <div>Zeitraum</div>
    <div>Status</div>

    <div class="th-sort"
         role="button" tabindex="0"
         (click)="toggleCreatedSort()"
         (keydown.enter)="toggleCreatedSort()"
         [attr.aria-sort]="sortDir==='desc' ? 'descending' : 'ascending'">
      Erstellt am
      <mat-icon class="caret" [class.asc]="sortDir==='asc'">arrow_drop_down</mat-icon>
    </div>

    <div class="actions">Aktionen</div>
  </div>

  <div class="row" *ngFor="let s of items">
    <div class="title">{{ s.title }}</div>
    <div class="range">
      <span *ngIf="s.startAt as a">{{ a | date:'dd.MM.yyyy' }}</span>
      –
      <span *ngIf="s.endAt as b">{{ b | date:'dd.MM.yyyy' }}</span>
    </div>
    <div><span class="{{ statusClass(s.status) }}">{{ s.status }}</span></div>
    <div class="created">
      <span *ngIf="s.createdAt as c">{{ c | date:'dd.MM.yyyy HH:mm' }}</span>
      <span *ngIf="!s.createdAt">–</span>
    </div>

    <div class="actions">
      <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Aktionen">
        <mat-icon>more_vert</mat-icon>
      </button>

      <mat-menu #menu="matMenu">
        <button
          mat-menu-item
          [routerLink]="['/admin/umfragen', s.id, 'edit']"
          matTooltip="Umfrage bearbeiten">
          <mat-icon>edit</mat-icon>
          <span>Bearbeiten</span>
        </button>

        <button mat-menu-item *ngIf="s.status==='draft'" (click)="publish(s)">
          <mat-icon>publish</mat-icon>
          <span>Veröffentlichen</span>
        </button>
        <button mat-menu-item *ngIf="s.status==='published' || s.status ==='closed'" (click)="unpublish(s)">
          <mat-icon>undo</mat-icon>
          <span>Zurückziehen</span>
        </button>
        <button mat-menu-item *ngIf="s.status==='published' || s.status ==='draft' " (click)="close(s)">
          <mat-icon>lock</mat-icon>
          <span>Schließen</span>
        </button>
        <button mat-menu-item (click)="remove(s)" class="warn">
          <mat-icon class="warn">delete</mat-icon>
          <span>Löschen</span>
        </button>
      </mat-menu>
    </div>
  </div>
</div>
